---
title: web前端基础 -- JavaScript应用
date: 2021-02-28 19:45:04
permalink: /pages/fb88ac/
---
# web前端基础 -- JavaScript应用


## DOM基础

* DOM ==Document Object Model==  文档对象模型

* DOM 是 HTML 的编程接口

* DOM 的基本操作，四大类

  * ##### 1. 增 ：创建节点并插入到 DOM 树中

    > *  `createElement` ：创建元素节点
    >
    >   ```js
    >   let node = document.createElement("p");
    >   node.textContext = "create successed ";
    >   ```
    >
    > * `ParentElement.appendChild()` ：添加元素
    >
    >   ```js
    >   let node = document.createElement("p");
    >   node.textContext = "create successed ";
    >   
    >   let parent = document.querySelector("div");
    >   //将 node 元素添加到第一个 div 的子节点列表的末尾
    >   parent.appendChild(node);
    >   ```

  * ##### 2.删 ：删除节点

    > * `Element.remove()` ：删除节点
    >
    >   ```js
    >   let removeNode = document.querySelector("ul > li");
    >   removeNode.remove();
    >   ```

  * ##### 3.改 ：修改 DOM 的属性和内容

    > * `Element.innerHTML` ：内容中的标签会被识别为 ==HTML== 格式
    >
    >   ```js
    >   let temp = document.getElementById("id");
    >   temp.innerHTML = "<span> this is innerHtml </span>";
    >   ```
    >
    > * `Element.textContent`：新的内容会被完整的呈现在页面上，无法转换为 ==HTML==
    >
    >   ```js
    >   let temp = document.getElementById("id");
    >   temp.textContent = "<span> this is innerHtml </span>";
    >   ```
    >
    > * `Element.setAttribute()` ：修改元素指定的属性值
    >
    >   ```js
    >   /*
    >   	需要注意 属性名 中，所有的大写字母均会被转换为小写字母
    >   */
    >   let temp = document.getElementById("id");
    >   temp.setAttribute("color","red");
    >   ```
    >
    > * `Element.getAttribute()` ：获取节点属性名对应的属性值
    >
    >   ```js
    >   let temp = document.getElementById("id");
    >   console.log(temp.getAttribute("color"));
    >   ```
    >
    > * `Element.style` ：修改所选节点的样式
    >
    >   ```js
    >   let temp = document.getElementById("id");
    >   temp.style = "color : red";
    >   ```

  * ##### 4.查 ：获取 DOM 节点

    > * 通过执行 document 上的成员函数，传入 id，class，tagName等指定条件，获取DOM节点
    >
    >   1. 通过 `id` 查找
    >
    >   ```js
    >   //如果页面存在id重名的情况，只会返回第一个节点的DOM对象
    >   let id =  document.getElementsById("id");
    >   ```
    >
    >   2. 通过标签名查找`tagName`
    >
    >   ```js
    >   /*
    >   	返回的是 NodeList
    >   	NodeList 通常是一个实时集合
    >   	它不是一个数组，是一个类似数组的对象
    >   */
    >   let tag = document.getElementsByTagName("span");
    >   ```
    >
    >   3. 通过 `class` 查找
    >
    >   ```js
    >   /*
    >   	同样返回的是 NodeList 数组
    >   */
    >   let class = document.getElementsByClassName("class")
    >   ```
    >
    > * 通过 CSS 选择器查询 DOM 节点
    >
    >   * `querySelector` 只返回第一个匹配到的 DOM 节点
    >
    >   ```js
    >   //查找第一个标签为 p 的节点
    >   let p = document.querySelector("p");
    >   ```
    >
    >   * `querySelectorAll` 返回所有 DOM 节点的集合
    >
    >   ```js
    >   //查找所有标签为 p 的节点
    >   let p = document.querySelectorAll("p");
    >   
    >   //查找所有类名为 detail 的节点
    >   let detail = document.querySelectorAll(".detail");
    >   
    >   //匹配所有包含属性 data-index 的所有节点
    >   let index = document.querySelectorAll("[data-index]");
    >   
    >   //匹配 main 中所有的子元素
    >   let star = document.querySelectorAll("main > *");
    >   
    >   //匹配 main 中所有的子孙元素
    >   let star = document.querySelectorAll("main *");
    >   
    >   //匹配紧邻 img 的所有 <h3> 元素(相邻兄弟选择器)
    >   let h3 = document.querySelectorAll("img + h3");
    >   ```
    >
    > * 通过已获取到的 DOM 节点对象，访问 DOM 对象上的成员，获取到与该 DOM 节点相关的父、子、兄弟节点
    >
    >   1. 根据获取到的节点直接获取该节点的子节点
    >
    >   ```js
    >   let parent = document.getElementById("id");
    >   let child = parent.children;//返回一个 NodeList
    >   ```
    >
    >   2. 获取当前节点的父节点
    >
    >   ```js
    >   let child = document.getElementById("id");
    >   let parent = child.parentNode;
    >   ```
    >
    >   3. 获取当前节点的兄弟节点
    >
    >   ```js
    >   let node = document.getElementById("id");
    >   let bro = node.nextElementSibling;
    >   ```

## DOM 事件

DOM 事件 ==(浏览器回调函数)== 是 `JavaScript` 与 `HTML` 交互的基础

常见的事件类别有

* 鼠标事件

  ```js
  // onclick
  let spanDom = document.querySelector("span");
  spanDom.onclick = function(event){
      console.log(event);
      alert("点击事件");
  }
  ```

* 触摸事件

* 键盘事件

* 媒体事件

* 剪切板事件

* 资源事件

* ...

### 事件的冒泡

* 页面上 DOM 之间是嵌套的结构
* 同样 如果给三个嵌套元素各自添加各自的绑定事件（注意：三个嵌套元素事件触发机制是同一个），当触发最里层元素事件后，外层元素事件依次冒泡执行
* 事件的传播:
  * 事件捕获阶段
  * 目标事件阶段
  * 事件冒泡阶段

### 事件的绑定

* `element.onclick = function(event){ ... }` ：DOM  0级

  ```js
  // onclick
  let spanDom = document.querySelector("span");
  spanDom.onclick = function(event){
      console.log(event);
      alert("点击事件");
  }
  ```

* `addEventListener()` ：支持在同一元素绑定多个事件。DOM 2级

  ```js
  /*
  	addEventListener(事件类型,处理函数,可选的对象{
  	capture: Boolean 表示 listener 会在该类型的事件捕获阶段传播到该 EventTarget 时触发。
  	once   : Boolean 表示 listener 在添加之后最多只调用一次。如果是 true， listener 会在其被			  调用之后自动移除。
  	passive: Boolean 设置为true时，表示 listener 永远不会调用 preventDefault()。如果 				 listener 仍然调用了这个函数，客户端将会忽略它并抛出一个控制台警告。查看 使用 passive 	  		  改善的滚屏性能 了解更多.
   	mozSystemGroup: 只能在 XBL 或者是 Firefox' chrome 使用，这是个 Boolean，表示 listener 						被添加到 system group。
  });
  */
  let span2Dom = document.querySelectorAll("span")[1];
  span2Dom.addEventListener("click",(event)=>{
      console.log("span2 click");
  });
  
  span2Dom.addEventListener("click",(event)=>{
      console.log("once span2 click");
  },{once:true});
  ```

## BOM 简介

  BOM ==(Browser Object Model)== ，浏览器对象模型

  BOM 是控制浏览器行为的接口

  通过 `window` 可以直接访问浏览器提供的 BOM 对象

  * location
  * navigator
  * screen
  * alert、prompt、confirm
  * localStorage
  * ...

#### example

* ```js
  //alert() 弹出一个提示框
  window.alert("弹出框");
  ```

* ```js
  //prompt() 对话框 返回填入的内容
  let result = window.prompt("please insert name",'siroi');
  console.log(result);
  ```

* ```js
  //navigator 获取浏览器和系统信息
  let info = window.navigator;
  console.log(info);
  console.log(info.userAgent);
  
  //获取电池相关
  //getBattery() 返回一个promise对象
  window.navigator.getBattery().then((battery)=>{
      console.log(battery.charging); //是否充电
      console.log(battery.level * 100 + "%"); //电池电量统计
  });
  ```

* ```js
  //confirm() 是否确认提示框
  let confirmResult = window.confirm("是否跳转到siroi");
  if(confirmResult){
      window.location.href = "https://www.siroi.top";
  }
  ```

* ```js
  //location属性
  console.log("完整URL: " + location.href);
  console.log("协议头: " + location.protocol);
  console.log("域名: " + location.host);
  console.log("路径: " + location.pathname);
  console.log("参数: " + location.search);
  console.log("哈希值: " + location.hash);
  ```

## 更多浏览器 API - AJAX

AJAX 是异步的  `JavaScript` 和 `XML` (Asynchronous JavaScript And XML)

浏览器为 JS 提供了两种方式去实现 AJAX

* `XMLHttpRequest`

  ```js
  //1.创建xmlHttpRequest object
  let xmlHttpRequest = new XMLHttpRequest();
  if(!xmlHttpRequest){
      alert("no support");
  }else{
      //2.回调函数
      xmlHttpRequest.onreadystatechange = ()=>{
          if(xmlHttpRequest.readyState === xmlHttpRequest.DONE){
              if(xmlHttpRequest.status === 200){
                  console.log(xmlHttpRequest.responseText);
              }else{
                  console.log("wrong status");
              }
          }else{
              console.log(xmlHttpRequest.readyState);
          }
      };
  
      //3.进行请求
      xmlHttpRequest.open("GET","https://cdn.jsdelivr.net/gh/Fuukei/Public_Repository@latest/vision/display_icon/muh2/github.png");
  
      xmlHttpRequest.send();
  }
  ```

* `Fetch`

  ```js
  //2.fetch 方式
  fetch("https://cdn.jsdelivr.net/gh/Fuukei/Public_Repository@latest/vision/display_icon/muh2/next.png").then(
      (response)=>{
          return response.blob();//确定返回的类型
          /*
          	常见的有{
          		blob();//图片
          		text();//xml文件
          		json();//json 格式
          	}
          */
      }
  ).then(
      (result)=>{
       console.log(result);   
      }
  );
  ```

## localStorage and sessionStorage



